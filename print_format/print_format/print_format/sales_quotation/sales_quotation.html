<!-- PDF Margins - Meta Tags for wkhtmltopdf -->
<meta name="margin-top" content="5mm">
<meta name="margin-bottom" content="5mm">
<meta name="margin-left" content="5mm">
<meta name="margin-right" content="5mm">


<!-- Letterhead -->
<div style="height:5px;"></div>
<div style="width:100%; text-align:center; margin:0 0 5px 0;">
  <img src="/files/company.png" alt="Letterhead" style="max-width:100%; height:auto; display:block; margin:0 auto;">
</div>

<!-- Heading -->
<div style="height:5px;"></div>

<div style="width:100%;max-width:100%;margin:0 0 5px 0;padding:0;background:#fff;font-family:'Cairo',Tahoma,Arial,sans-serif;box-sizing:border-box;box-shadow:0 1px 3px rgba(255,182,49,0.09);direction:rtl;overflow:hidden;">
  <div style="display:flex;justify-content:center;align-items:center;padding:4px 10px;line-height:1;text-align:center;white-space:nowrap;font-weight:bold;color:#000;font-size:1.4em;letter-spacing:.5px;">
    {% set customer_doc = frappe.get_doc("Customer", doc.party_name) %}
    {% set has_vat = customer_doc.custom_vat_registration_number %}
    {% set extra_ids = [] %}
    {% for row in customer_doc.custom_additional_ids %}
        {% if row.value %}
            {% set _ = extra_ids.append(1) %}
        {% endif %}
    {% endfor %}
    {% if has_vat or extra_ids %}
        عرض سعر - فاتورة ضريبية قياسية
    {% else %}
        عرض سعر - فاتورة ضريبية مبسطة
    {% endif %}
  </div>
</div>

<!-- Customer Info -->
<div style="border:1.5pt solid #000; border-radius:8pt; background:#fff; width:100%; margin:0 0 2pt 0; padding:0; font-family:'Cairo',Tahoma,Arial,sans-serif; direction:rtl; box-sizing:border-box;">
  <table style="width:100%; border-collapse:collapse; margin:0; padding:0; line-height:1.1; font-family:'Cairo',Tahoma,Arial,sans-serif; table-layout:auto;">
    <tbody>
      {% set customer_doc = frappe.get_doc("Customer", doc.party_name) %}

      {% if doc.customer_name or doc.name %}
      <tr style="font-size:10pt; line-height:1.1; white-space:nowrap;">
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">اسم العميل</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ doc.customer_name or "" }}</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">رقم عرض السعر</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ doc.name }}</td>
      </tr>
      {% endif %}

      {% set address_name = frappe.db.get_value("Dynamic Link", {"link_doctype": "Customer", "link_name": doc.party_name}, "parent") %}
      {% set address_line2 = "" %}{% set custom_area = "" %}{% set address_line1 = "" %}{% set city = "" %}{% set pincode = "" %}
      {% if address_name %}
        {% set address_values = frappe.db.get_value("Address", address_name, ["address_line2","custom_area","address_line1","city","pincode"]) %}
        {% if address_values %}
          {% set address_line2 = address_values[0] %}{% set custom_area = address_values[1] %}{% set address_line1 = address_values[2] %}{% set city = address_values[3] %}{% set pincode = address_values[4] %}
        {% endif %}
      {% endif %}
      {% if address_line1 or city or pincode or doc.transaction_date %}
      <tr style="font-size:10pt; line-height:1.1; white-space:nowrap;">
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">العنوان</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">
          {% set address_parts = [] %}
          {% if address_line2 %}{% set _ = address_parts.append(address_line2) %}{% endif %}
          {% if custom_area %}{% set _ = address_parts.append(custom_area) %}{% endif %}
          {% if address_line1 %}{% set _ = address_parts.append(address_line1) %}{% endif %}
          {% if city %}{% set _ = address_parts.append(city) %}{% endif %}
          {{ address_parts | join(', ') }}
        </td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">تاريخ العرض</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">
          {% if doc.transaction_date %}
            {% set days_ar = ['الاثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت','الأحد'] %}
            {% set dt = frappe.utils.get_datetime(doc.transaction_date) %}
            {% set weekday = dt.weekday() %}
            {{ days_ar[weekday] }} {{ "%02d"|format(dt.day) }}-{{ "%02d"|format(dt.month) }}-{{ dt.year }}
          {% endif %}
        </td>
      </tr>
      {% endif %}

      {% if customer_doc.custom_vat_registration_number or doc.valid_till %}
      <tr style="font-size:10pt; line-height:1.1; white-space:nowrap;">
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">الرقم الضريبي</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ customer_doc.custom_vat_registration_number or "" }}</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">مدة صلاحية العرض</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">
          {% if doc.valid_till %}
            {% set days_ar = ['الاثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت','الأحد'] %}
            {% set valid_dt = frappe.utils.get_datetime(doc.valid_till) %}
            {% set valid_weekday = valid_dt.weekday() %}
            حتى {{ days_ar[valid_weekday] }} {{ "%02d"|format(valid_dt.day) }}-{{ "%02d"|format(valid_dt.month) }}-{{ valid_dt.year }}
          {% endif %}
        </td>
      </tr>
      {% endif %}

      {% if customer_doc.custom_cr_number or doc.contact_email %}
      <tr style="font-size:10pt; line-height:1.1; white-space:nowrap;">
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">السجل التجاري</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ customer_doc.custom_cr_number or "" }}</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">البريد الإلكتروني</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ doc.contact_email or "" }}</td>
      </tr>
      {% endif %}

      {% if customer_doc.custom_700_number or doc.contact_mobile %}
      <tr style="font-size:10pt; line-height:1.1; white-space:nowrap;">
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">الرقم الموحد</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ customer_doc.custom_700_number or "" }}</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; font-weight:bold; width:15%; white-space:nowrap; vertical-align:middle;">رقم الجوال</td>
        <td style="border:none; padding:1pt; color:#111; text-align:right; width:35%; white-space:nowrap; vertical-align:middle;">{{ doc.contact_mobile or "" }}</td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% if doc.custom_description %}
<div style="margin-top:1px; margin-bottom:1px; padding:12px 16px; background:#fff; border-radius:8px; border:2px solid #000; font-family:'Cairo',Tahoma,Arial,sans-serif; font-size:1.05em; color:#444; text-align:right;">
  {{ doc.custom_description }}
</div>
{% endif %}

<!-- Items Table -->
<div style="border: 2px solid #000; border-radius: 8px; overflow: hidden; direction: rtl; font-family: 'Cairo', Tahoma, Arial, sans-serif;">
  <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
    <thead>
      <tr style="border-bottom: 2px solid #666;">
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: center; width: 30px; vertical-align:middle;">م</th>
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: center; border-left: 1px solid #ccc; width: 80px; vertical-align:middle;">الكود</th>
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: right; border-left: 1px solid #ccc; vertical-align:middle;">الصنف</th>
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: center; border-left: 1px solid #ccc; width: 60px; vertical-align:middle;">الوحدة</th>
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: center; border-left: 1px solid #ccc; width: 70px; vertical-align:middle;">الكمية</th>
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: center; border-left: 1px solid #ccc; width: 80px; vertical-align:middle;">السعر</th>
        <th style="background: #eee; padding: 10px 6px; font-weight: bold; text-align: center; border-left: 1px solid #ccc; width: 100px; vertical-align:middle;">الإجمالي</th>
      </tr>
    </thead>
    <tbody>
      {% for row in doc.items %}
        {% set row_style = "" %}
        {% if loop.index % 2 == 0 %}
          {% set row_style = row_style + "background: #f9f9f9; " %}
        {% endif %}
        {% if not loop.last %}
          {% set row_style = row_style + "border-bottom: 1px dotted #aaa; " %}
        {% endif %}
        <tr{% if row_style %} style="{{ row_style|trim }}"{% endif %}>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: center; width: 30px;">{{ loop.index }}</td>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: center; width: 80px;">{{ row.item_code }}</td>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: right;">{{ row.description }}</td>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: center; width: 60px;">{{ row.uom }}</td>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: center; width: 70px;">{{ "{:,.2f}".format(row.qty or 0) }}</td>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: center; direction: ltr; width: 80px;">
            {{ "{:,.2f}".format(row.net_rate or 0) }}
          </td>
          <td style="padding: 7px 5px; font-size: 0.9em; vertical-align: middle; text-align: center; direction: ltr; width: 100px;">
            {{ "{:,.2f}".format(row.net_amount or 0) }}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Totals -->
<div style="width:300px; margin:3px 0 0 0; border:1px solid #000; border-radius:8px; overflow:hidden; background:transparent; direction:rtl; font-family:'Arial',sans-serif; page-break-inside:avoid; unicode-bidi: embed; display: block; margin-top: 10px; margin-bottom: 10px;">
  <table style="width:100%; border-collapse:collapse; font-size:15px; margin:0; padding:0; line-height:1;">
    <tbody>
      <tr>
        <th style="margin:0; padding:7px 5px; line-height:1; vertical-align:middle; border-bottom:1px solid #ddd; border-top:none; border-left:none; border-right:none; font-weight:bold; text-align:right; direction:rtl; display:table-cell;">الإجمالي غير شامل الضريبة</th>
        <td dir="ltr" style="margin:0; padding:7px 5px; line-height:1; border-bottom:1px solid #ddd; border-top:none; border-left:none; border-right:none; font-weight:bold; direction:ltr; white-space:nowrap; font-variant-numeric:tabular-nums; vertical-align:middle; display:table-cell; text-align:left;">
          {{ frappe.utils.fmt_money(doc.net_total, currency=doc.currency) | safe }}
        </td>
      </tr>
      <tr>
        <th style="margin:0; padding:7px 5px; line-height:1; vertical-align:middle; border-bottom:1px solid #ddd; border-top:none; border-left:none; border-right:none; font-weight:bold; text-align:right; direction:rtl; display:table-cell;">مجموع قيمة الضريبة</th>
        <td dir="ltr" style="margin:0; padding:7px 5px; line-height:1; border-bottom:1px solid #ddd; border-top:none; border-left:none; border-right:none; font-weight:bold; direction:ltr; white-space:nowrap; font-variant-numeric:tabular-nums; vertical-align:middle; display:table-cell; text-align:left;">
          {{ frappe.utils.fmt_money(doc.total_taxes_and_charges, currency=doc.currency) | safe }}
        </td>
      </tr>
      <tr>
        <th style="margin:0; padding:7px 5px; line-height:1; vertical-align:middle; border-bottom:1px solid #ddd; border-top:none; border-left:none; border-right:none; font-weight:bold; text-align:right; direction:rtl; display:table-cell;">الإجمالي شامل الضريبة</th>
        <td dir="ltr" style="margin:0; padding:7px 5px; line-height:1; border-bottom:1px solid #ddd; border-top:none; border-left:none; border-right:none; font-weight:bold; direction:ltr; white-space:nowrap; font-variant-numeric:tabular-nums; vertical-align:middle; display:table-cell; text-align:left;">
          {{ frappe.utils.fmt_money(doc.grand_total, currency=doc.currency) | safe }}
        </td>
      </tr>

      <tr>
        <td colspan="2" style="margin:0; padding:7px 5px; font-size:16px; line-height:1.4; font-weight:bold; text-align:center; color:#222; border:none; word-wrap:break-word; white-space:normal; overflow-wrap:break-word;">
          {{ doc.custom_tafqeet_amount }}
        </td>
      </tr>
    </tbody>
  </table>
</div>

{% if doc.custom_description2 %}
<div style="margin-top:1px; margin-bottom:1px; padding:12px 16px; font-family:'Cairo',Tahoma,Arial,sans-serif; font-size:1.05em; color:#444; text-align:right;">
  {{ doc.custom_description2 }}
</div>
{% endif %}

<!-- Signatures - Moved to bottom, PDF compatible -->
<div style="width:100%; margin-top:30px; margin-bottom:10px; overflow:hidden; background:#fff; font-family:'Cairo', Tahoma, Arial, sans-serif; line-height:1; border:none; padding:10px 0; page-break-inside:avoid;">
  <table style="width:100%; border:none; background:none; border-spacing:0; direction:rtl; line-height:1; margin:0; padding:0;">
    <tbody>
      <tr>
        <td style="font-family:'Cairo', Arial, sans-serif; font-size:0.92em; padding:5px; vertical-align:middle; color:#222; font-weight:700; letter-spacing:0.1px; text-align:center; border:none; width:50%;">
          {% if doc.owner %}
            {% set created_by = frappe.db.get_value("User", doc.owner, "full_name") or doc.owner %}
            <div style="margin-bottom: 10px;">
              <span style="font-size: 12px; font-weight: bold; border: 1.2px solid #1976d2; padding: 3px 10px; border-radius: 7px; font-family: 'Arial', sans-serif; background: #e3f0fb; color: #1976d2; display: inline-block; line-height: 1.3; text-align: center; letter-spacing: 0.5px;">
                تم الإنشاء<br>{{ created_by }}
              </span>
            </div>
          {% endif %}
          البائع
        </td>
        <td style="font-family:'Cairo', Arial, sans-serif; font-size:0.92em; padding:5px; vertical-align:middle; color:#222; font-weight:700; letter-spacing:0.1px; text-align:center; border:none; width:50%;">
          {% if doc.status %}
            {% set status_translation = {
              "Draft": "مسودة",
              "Submitted": "تم الإرسال",
              "Ordered": "تم الطلب",
              "Lost": "مفقود",
              "Cancelled": "ملغي"
            } %}
            {% set translated_status = status_translation.get(doc.status, doc.status) %}
            <div style="margin-bottom: 10px;">
              {% if doc.status == "Ordered" %}
              <span style="font-size: 15px; font-weight: bold; padding: 5px 22px; border-radius: 7px; font-family: Arial, sans-serif; display: inline-block; line-height: 1.2; text-align: center; background:#e6f7ea; color:#0A9928; border:1.2px solid #0A9928;">
                {{ translated_status }}
              </span>
              {% elif doc.status == "Submitted" %}
              <span style="font-size: 15px; font-weight: bold; padding: 5px 22px; border-radius: 7px; font-family: Arial, sans-serif; display: inline-block; line-height: 1.2; text-align: center; background:#eaf1fb; color:#007BFF; border:1.2px solid #007BFF;">
                {{ translated_status }}
              </span>
              {% elif doc.status == "Lost" %}
              <span style="font-size: 15px; font-weight: bold; padding: 5px 22px; border-radius: 7px; font-family: Arial, sans-serif; display: inline-block; line-height: 1.2; text-align: center; background:#fdeaea; color:#D23; border:1.2px solid #D23;">
                {{ translated_status }}
              </span>
              {% elif doc.status == "Cancelled" %}
              <span style="font-size: 15px; font-weight: bold; padding: 5px 22px; border-radius: 7px; font-family: Arial, sans-serif; display: inline-block; line-height: 1.2; text-align: center; background:#f5f5f5; color:#6C757D; border:1.2px solid #6C757D;">
                {{ translated_status }}
              </span>
              {% elif doc.status == "Draft" %}
              <span style="font-size: 15px; font-weight: bold; padding: 5px 22px; border-radius: 7px; font-family: Arial, sans-serif; display: inline-block; line-height: 1.2; text-align: center; background:#f5f5f5; color:#C4C4C4; border:1.2px solid #C4C4C4;">
                {{ translated_status }}
              </span>
              {% else %}
              <span style="font-size: 15px; font-weight: bold; padding: 5px 22px; border-radius: 7px; font-family: Arial, sans-serif; display: inline-block; line-height: 1.2; text-align: center; background:#f5f5f5; color:#222; border:1.2px solid #bbb;">
                {{ translated_status }}
              </span>
              {% endif %}
            </div>
          {% endif %}
          المستلم
        </td>
      </tr>
      <tr>
        <td style="font-family:'Cairo', Arial, sans-serif; font-size:0.92em; vertical-align:middle; color:#222; font-weight:700; letter-spacing:0.1px; text-align:center; border:none; height:30px; padding:5px 5px 0 5px;"></td>
        <td style="font-family:'Cairo', Arial, sans-serif; font-size:0.92em; vertical-align:middle; color:#222; font-weight:700; letter-spacing:0.1px; text-align:center; border:none; height:30px; padding:5px 5px 0 5px;"></td>
      </tr>
      <tr>
        <td style="font-family:'Cairo', Arial, sans-serif; font-size:0.92em; padding:0 5px; vertical-align:middle; color:#222; font-weight:700; letter-spacing:0.1px; text-align:center; border:none; height:1px;">
          <div style="width:150px; margin:0 auto; border-top:2px dotted #000;"></div>
        </td>
        <td style="font-family:'Cairo', Arial, sans-serif; font-size:0.92em; padding:0 5px; vertical-align:middle; color:#222; font-weight:700; letter-spacing:0.1px; text-align:center; border:none; height:1px;">
          <div style="width:150px; margin:0 auto; border-top:2px dotted #000;"></div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Footer from Letter Head -->
{% if footer %}
{{ footer | safe }}
{% endif %}
